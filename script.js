const i18n = {
  ja: {
    brand: "Anime Pilgrimage Japan",
    "nav.tours": "ツアー",
    "nav.why": "選ばれる理由",
    "nav.faq": "FAQ",
    "nav.contact": "お問い合わせ",
    "hero.title": "アニメの世界を旅しよう",
    "hero.subtitle": "聖地で感じる名場面。少人数・多言語ガイドが、移動も手配もまるごとサポート。",
    "hero.ctaPrimary": "ツアーを予約",
    "hero.ctaSecondary": "ルートを見る",
    "hero.meta": "英語・日本語対応／小規模グループ／カスタム手配可",
    "why.title": "選ばれる理由",
    "why.local.title": "アニメ愛 × 旅のプロ",
    "why.local.body": "作品に精通したバイリンガルの有資格ガイドが、聖地の背景やマナーまで丁寧にご案内。",
    "why.seamless.title": "移動も入場もシームレス",
    "why.seamless.body": "交通・チケット・翻訳までお任せ。迷わず効率よく、名場面を存分に巡れます。",
    "why.curated.title": "厳選ルートと季節演出",
    "why.curated.body": "定番から穴場、祭りや桜・紅葉シーズンまで。作品世界を最大化するベストタイミングでご提案。",
    "why.flex.title": "少人数・貸切に柔軟対応",
    "why.flex.body": "1名から参加OK。プライベート手配、食事制限やペース配分なども相談可能です。",
    "why.transparent.title": "明瞭価格・安心サポート",
    "why.transparent.body": "隠れ費用なし。キャンセル規定明確、天候・混雑時の代替案もご用意。",
    "tours.title": "モデルルート",
    "tours.tokyo.title": "東京クラシックス",
    "tours.tokyo.desc": "『君の名は。』や『STEINS;GATE』の舞台、秋葉原・四ツ谷・神田明神などを効率よく。",
    "tours.tokyo.duration": "1日（7–8時間）",
    "tours.tokyo.price": "¥18,000/人〜",
    "tours.kansai.title": "関西トレイル",
    "tours.kansai.desc": "京都『氷菓』、豊郷『けいおん！』旧校舎、奈良の名所を組み合わせて文化も満喫。",
    "tours.kansai.duration": "1–2日",
    "tours.kansai.price": "¥22,000/人〜",
    "tours.seaside.title": "海辺エスケープ",
    "tours.seaside.desc": "沼津『ラブライブ！サンシャイン!!』や江の島・鎌倉など、海と聖地を一度に。",
    "tours.seaside.duration": "1日",
    "tours.seaside.price": "¥20,000/人〜",
    "tours.duration.label": "所要",
    "tours.group.label": "人数",
    "tours.group.value": "最大8名",
    "tours.price.label": "料金",
    "tours.note": "プライベート/カスタムは別途お見積もり（例：¥80,000/日〜 6名まで）。JRパス対応ルート可。",
    "season.title": "ベストシーズン",
    "season.spring.title": "春（3–4月）",
    "season.spring.body": "桜と聖地のコラボ。早朝・夕景で混雑回避の時間設計。",
    "season.summer.title": "夏（7–8月）",
    "season.summer.body": "祭りや花火と合わせた特別行程。熱中症対策も万全に。",
    "season.autumn.title": "秋（10–11月）",
    "season.autumn.body": "紅葉の映えるロケーションへ。撮影スポットを的確にご案内。",
    "quotes.1": "“あのシーンが目の前に。移動もスムーズで安心して楽しめました！” — 米国ゲスト",
    "quotes.2": "“ガイドさんの知識がすごい！ローカルグルメも最高でした” — 台湾ゲスト",
    "faq.title": "よくある質問",
    "faq.lang.q": "対応言語は？",
    "faq.lang.a": "英語・日本語に対応。必要に応じて他言語も手配可能です。",
    "faq.cancel.q": "キャンセル規定は？",
    "faq.cancel.a": "7日前まで無料。以降は規定に基づき一部ご負担いただきます。",
    "faq.fitness.q": "体力に自信がなくても参加できますか？",
    "faq.fitness.a": "無理のないペースで調整します。階段や坂の少ないルートも選べます。",
    "faq.weather.q": "雨天時はどうなりますか？",
    "faq.weather.a": "屋内スポットや代替行程をご提案。安全第一で催行判断します。",
    "faq.payment.q": "支払い方法は？",
    "faq.payment.a": "主要クレジットカード・海外発行カードに対応。事前決済をお願いしています。",
    "booking.title": "予約・お問い合わせ",
    "booking.lead": "ご希望の日程と人数、興味のある作品をお知らせください。24時間以内に回答します。",
    "form.name": "お名前",
    "form.email": "メールアドレス",
    "form.date": "ご希望日",
    "form.group": "人数",
    "form.message": "メッセージ",
    "form.submit": "送信する",
    "contact.whatsapp": "WhatsAppで相談（準備中）",
    "contact.base": "拠点：東京／京都",
    "footer.copy": "© 2025 Anime Pilgrimage Japan",
    "footer.terms": "利用規約",
    "footer.privacy": "プライバシー",
    "footer.imprint": "特定商取引法に基づく表記"
  },
  en: {
    brand: "Anime Pilgrimage Japan",
    "nav.tours": "Tours",
    "nav.why": "Why Us",
    "nav.faq": "FAQ",
    "nav.contact": "Contact",
    "hero.title": "Journey Into Anime — For Real",
    "hero.subtitle": "Step into iconic scenes at real locations. Small groups, bilingual guides, logistics handled end‑to‑end.",
    "hero.ctaPrimary": "Book a Tour",
    "hero.ctaSecondary": "See Routes",
    "hero.meta": "EN/JP guides • Small groups • Custom trips",
    "why.title": "Why Travelers Choose Us",
    "why.local.title": "Otaku Guides, Licensed Pros",
    "why.local.body": "Bilingual licensed guides who truly love anime share context, etiquette, and hidden details.",
    "why.seamless.title": "Seamless Logistics",
    "why.seamless.body": "Transit, tickets, and translation covered so you focus on the magic.",
    "why.curated.title": "Curated & Seasonal",
    "why.curated.body": "From classics to hidden gems, timed for festivals, cherry blossoms, and foliage.",
    "why.flex.title": "Flexible & Private",
    "why.flex.body": "Join solo or as a group. Private custom trips, dietary and pacing options.",
    "why.transparent.title": "Transparent & Safe",
    "why.transparent.body": "No hidden fees. Clear policies and weather/crowd backup plans.",
    "tours.title": "Sample Routes",
    "tours.tokyo.title": "Tokyo Classics",
    "tours.tokyo.desc": "Your Name, Steins;Gate, Akihabara, Yotsuya, Kanda Shrine — all in one efficient day.",
    "tours.tokyo.duration": "1 day (7–8h)",
    "tours.tokyo.price": "From ¥18,000/person",
    "tours.kansai.title": "Kansai Trails",
    "tours.kansai.desc": "Kyoto Hyouka, Toyosato K‑ON! old school, plus Nara highlights and culture.",
    "tours.kansai.duration": "1–2 days",
    "tours.kansai.price": "From ¥22,000/person",
    "tours.seaside.title": "Seaside Escape",
    "tours.seaside.desc": "Numazu Love Live! Sunshine!! with Enoshima and Kamakura coastal spots.",
    "tours.seaside.duration": "1 day",
    "tours.seaside.price": "From ¥20,000/person",
    "tours.duration.label": "Duration",
    "tours.group.label": "Group",
    "tours.group.value": "Up to 8",
    "tours.price.label": "Price",
    "tours.note": "Private/custom from ¥80,000/day (up to 6). JR Pass‑friendly routes available.",
    "season.title": "Best Seasons",
    "season.spring.title": "Spring (Mar–Apr)",
    "season.spring.body": "Cherry blossoms and scenes. Early/late slots to avoid crowds.",
    "season.summer.title": "Summer (Jul–Aug)",
    "season.summer.body": "Festivals and fireworks add‑ons with heat‑safety planning.",
    "season.autumn.title": "Autumn (Oct–Nov)",
    "season.autumn.body": "Foliage frames your shots with guide‑picked photo spots.",
    "quotes.1": "“The scene came alive. Logistics were effortless!” — Guest from USA",
    "quotes.2": "“Super knowledgeable guides and amazing local food.” — Guest from Taiwan",
    "faq.title": "FAQ",
    "faq.lang.q": "What languages do you support?",
    "faq.lang.a": "English and Japanese, with other languages on request.",
    "faq.cancel.q": "What is your cancellation policy?",
    "faq.cancel.a": "Free up to 7 days prior; partial fees apply afterward.",
    "faq.fitness.q": "Do I need to be very fit?",
    "faq.fitness.a": "We adjust the pace and can choose routes with fewer stairs or slopes.",
    "faq.weather.q": "What if it rains?",
    "faq.weather.a": "We switch to indoor spots or backup routes, prioritizing safety.",
    "faq.payment.q": "How do I pay?",
    "faq.payment.a": "Major credit cards, including international cards. Advance payment required.",
    "booking.title": "Bookings & Inquiries",
    "booking.lead": "Tell us dates, group size, and favorite titles. We reply within 24 hours.",
    "form.name": "Name",
    "form.email": "Email",
    "form.date": "Preferred Date",
    "form.group": "Group Size",
    "form.message": "Message",
    "form.submit": "Send",
    "contact.whatsapp": "Chat on WhatsApp (coming soon)",
    "contact.base": "Base: Tokyo / Kyoto",
    "footer.copy": "© 2025 Anime Pilgrimage Japan",
    "footer.terms": "Terms",
    "footer.privacy": "Privacy",
    "footer.imprint": "Imprint"
  }
};

function applyI18n(lang) {
  const dict = i18n[lang] || i18n.ja;
  document.documentElement.lang = lang;
  document.querySelectorAll("[data-i18n]").forEach(el => {
    const key = el.getAttribute("data-i18n");
    if (dict[key]) el.textContent = dict[key];
  });
  document.querySelectorAll('.lang-btn').forEach(b => b.classList.toggle('active', b.dataset.lang === lang));
  const title = lang === 'en' ? 'Anime Pilgrimage Japan | Anime Tours in Japan' : 'Anime Pilgrimage Japan | アニメ聖地巡礼ツアー';
  const desc = lang === 'en' ? 'Small-group, bilingual guides for real-world anime locations across Japan.' : '外国人観光客向けの少人数・多言語ガイドによる日本アニメ聖地巡礼ツアー。';
  document.title = title;
  const metaDesc = document.querySelector('meta[name="description"]');
  if (metaDesc) metaDesc.setAttribute('content', desc);
}

document.addEventListener('DOMContentLoaded', () => {
  const saved = localStorage.getItem('apj-lang') || (navigator.language.startsWith('en') ? 'en' : 'ja');
  applyI18n(saved);
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const lang = btn.dataset.lang;
      localStorage.setItem('apj-lang', lang);
      applyI18n(lang);
    });
  });
  document.querySelectorAll('a[href^="#"]').forEach(a => {
    a.addEventListener('click', e => {
      const id = a.getAttribute('href');
      if (id.length > 1) {
        e.preventDefault();
        document.querySelector(id)?.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    });
  });

  // Booking form AJAX submission (Formspree-compatible)
  const FORM_ENDPOINT = 'https://formspree.io/f/your-id'; // TODO: replace with your Formspree form ID
  const form = document.getElementById('booking-form');
  const statusEl = document.getElementById('form-status');
  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      statusEl.textContent = saved === 'en' ? 'Sending…' : '送信中…';
      const formData = new FormData(form);
      const name = formData.get('name');
      const email = formData.get('email');
      if (!name || !email) {
        statusEl.textContent = saved === 'en' ? 'Name and Email are required.' : 'お名前とメールは必須です。';
        return;
      }
      try {
        const res = await fetch(FORM_ENDPOINT, {
          method: 'POST',
          headers: { 'Accept': 'application/json' },
          body: formData
        });
        if (res.ok) {
          form.reset();
          statusEl.textContent = saved === 'en' ? 'Thank you! We will reply within 24 hours.' : '送信ありがとうございます。24時間以内にご返信します。';
        } else {
          const data = await res.json().catch(() => ({}));
          const msg = data.errors?.map(e => e.message).join(', ');
          throw new Error(msg || 'Request failed');
        }
      } catch (err) {
        console.error(err);
        const subject = encodeURIComponent('[Tour Inquiry] Anime Pilgrimage Japan');
        const bodyLines = [
          `Name: ${formData.get('name') || ''}`,
          `Email: ${formData.get('email') || ''}`,
          `Date: ${formData.get('date') || ''}`,
          `People: ${formData.get('people') || ''}`,
          `Message: ${formData.get('message') || ''}`
        ];
        const body = encodeURIComponent(bodyLines.join('\n'));
        window.location.href = `mailto:hello@example.com?subject=${subject}&body=${body}`;
        statusEl.textContent = saved === 'en' ? 'Couldn’t reach server. Opened mail app as fallback.' : 'サーバに接続できませんでした。メールアプリを開きました。';
      }
    });
  }
});

